---
cdate: 2023-02-28
mdate: 2023-04-17
tbcdate: 2023-05-26
authorId: polubis
treviewerId: kwozniak
lreviewerId: kreszko
tags: architecture,project setup,patterns,quality gates
stack: typescript,react,rxjs,nx,cypress,jest,storybook,chromatic,redux,styled-components,next
description: It will be a longer article about project setup. Prepare a huge mug of coffee before you start reading.
readTime: 15
title: Dream stack for React dev
---

<Prelude>
  <M>Developers should work on functionalities. Did I say something weird?</M>
  <M>
    Many of you may disagree. What about creating a project? What about
    connecting <B>eslint</B>, <B>prettier</B>? What about preparing a test
    environment for <B>unit</B> and <B>e2e</B> tests? Seems like a lot of work.
    Honestly, it may be...
  </M>
  <M>
    However, today you'll see how you can do it easier/better/faster/stronger
    üéß.
  </M>
  <Hint hasBg>
    Here is a{" "}
    <A outside href="https://github.com/polubis/Dream-stack-for-React-dev/">
      final result
    </A>
    . Don't be afraid, just use it :0.
  </Hint>
</Prelude>

<Section>
  <XL>1. Monorepo</XL>
  <M>
    We'll divide our solution into <B>applications</B> and <B>libraries</B>. All
    of these will be stored in a single repository with the same configuration
    for linting, formatting, TypeScript, jest, cypress, storybook, ...etc.
  </M>
  <M>
    Thanks to this you will have the opportunity to run the applications
    separately or together. This is what you can achieve with <B>monorepo</B>.
    In simple words, it's a way of storing and managing a solution, which
    involves keeping the code in a single repository and dividing it into
    packages and applications accordingly.
  </M>
</Section>

<Section>
  <XL>2. Monorepo with nx</XL>
  <M>
    It's mainly a <B>CLI</B> and <B>patterns</B> that helps you to create and
    manage monorepo. Below is a list of cool things you will get with this
    technology:
  </M>
  <List items="apps and libs generation via CLI,organized structure,option to configure stuff like storybook via one command,dependency preview via graph,same configs for everything,configuration of the TypeScript,option to choose way of styling your components,routing configuration,bundler configuration, unit and e2e tests configuration, and many more..." />
</Section>

<Section>
  <XL>3. What will we create?</XL>
  <M>
    We are going to make a solution that will allow you to manage your blog and
    display the created articles/courses. So let's describe the components we'll
    create:
  </M>
  <List items="application for presenting the blog content and homepage,a blog management application,library for communicating with the API,utilities library,a library with components" />
  <M>
    Each component will be independent. It will reduce the risk of conflicts.
    Libs will be consumed by apps.
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/graph.png"
    description="Building blocks"
  />

  <Hint hasBg>
    Check out{" "}
    <A
      outside
      href="/articles/architecture/modular-architecture-for-medium-frontend-apps/"
    >
      this article
    </A>{" "}
    if you are interested in architecture.
  </Hint>
</Section>

<Section>
  <XL>4. Initialization of the project</XL>
  <M>
    First, install this script, which will start the <B>nx repository</B>:
  </M>
  <Hint hasBg>npm i -g create-nx-workspace@latest --legacy-peer-deps</Hint>
  <M>Later you need to type: </M>
  <Hint hasBg>npx create-nx-workspace@latest</Hint>
  <M>
    The CLI will ask you the following questions sequentially. You can find
    description of the options in{" "}
    <A outside href="https://nx.dev/getting-started/intro/">
      nx documentation
    </A>
    . Let's focus on creating our dream project.
  </M>
  <M>Answer the questions the same way I did.</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/questions.jpg"
    description="Questions and answers"
  />
  <M>The file and folder structure generated by nx should look like this:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/folders-and-files.jpg"
    description="Generated content for blog application"
  />
  <M>
    If you look at it you will see that by default you have <B>TypeScript</B>,{" "}
    <B>prettier</B> and <B>eslint</B> configured. In addition, tests in{" "}
    <B>jest</B> have been configured and e2e in <B>cypress</B>.
  </M>
  <M>
    We already have a project and app in <B>Next.js</B>. Now it's time for the{" "}
    <B>single page application in React</B>.
  </M>
  <Hint hasBg>cd .\system\</Hint>
  <Hint hasBg>npx nx g @nrwl/react:application blog-creator</Hint>
  <M>
    The tool may ask you to install additional dependencies, which it uses to
    generate folders and files. Confirm it. After that, you will see similar
    questions as before. Answer them the same way I did:
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/react-questions.jpg"
    description="React app done"
  />
  <M>
    We have the apps! After a while you'll see two new folders in the{" "}
    <B>apps</B> directory.
  </M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/25d239e6698c6d862afbff6fa481e784ca1b1a5e/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>5. Creating libraries</XL>
  <M>
    The idea is the same, only the questions and your answers differ. It's
    beautiful ‚ù§Ô∏è. Type the command:
  </M>
  <Hint hasBg>npx nx g @nrwl/react:lib figa-ui</Hint>
  <M>
    I named my component library after my beloved cat - <B>Figa</B>. You can
    name it after a turtle (or whatever pet you have at home). These are my
    answers:
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/ui-lib-setup.jpg"
    description="You have figa-ui installed :D"
  />
  <M>
    Now it's time to do the two simplest things. We need to create two{" "}
    <B>TypeScript</B> libraries. Type the following two commands:
  </M>
  <Hint hasBg>npx nx generate @nrwl/js:lib utils</Hint>
  <Hint hasBg>npx nx generate @nrwl/js:lib blog-api</Hint>
  <M>In both cases, choose the same answers:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/pure-ts-lib-answers.jpg"
    description="TypeScript libs are cool"
  />
  <M>We have what we wanted, so let's move on.</M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/5021144480bb788155a6cee17699a62ec5b5a74d/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>6. Adding storybook to UI library</XL>
  <M>
    <B>Storybook</B> will be needed for our components library. <B>Nx</B> allows
    per scope configuration or global one. We need scoped. So let's enter some
    commands:
  </M>
  <Hint hasBg>npm i --save @nrwl/storybook --legacy-peer-deps</Hint>
  <Hint hasBg>
    npx nx g @nrwl/storybook:configuration figa-ui
    --uiFramework=@storybook/react
  </Hint>
  <M>As usual there will be questions, answer as I did:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/storybook-answers.jpg"
    description="Storybook ready!"
  />
  <M>
    Now you can start the storybook process and play with it via this command:
  </M>
  <Hint hasBg>npx nx run figa-ui:storybook</Hint>
  <M>
    After a while, the <B>storybook window</B> will launch with the message that
    you don't have any story yet. We'll add the <B>Bell.tsx</B> and{" "}
    <B>Bell.stories.tsx</B> component to see if everything works as it should.
  </M>
  <Img
    src="/assets/dream-stack-for-react-dev/storybook-works.jpg"
    description="It works!"
  />
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/2bcf4873c2592b032015a24f3485c314230b6118/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>7. Running the applications</XL>
  <M>
    Now it begins :D. You can run all applications, one of them, or just the
    storybook. It depends what kind of feature you are already working on. To
    run single app type:
  </M>
  <Hint hasBg>npx nx serve blog</Hint>
  <M>You can run all apps via: </M>
  <Hint hasBg>
    npx nx run-many --parallel --target=serve --projects=blog,blog-creator
  </Hint>
  <M>or</M>
  <Hint hasBg>npx nx run-many --target=serve --all</Hint>
  <M>
    You can get an error about same port usage attempt. To fix it you need to
    visit <B>project.json</B> files and add port number. For each application
    add different one. After that type:
  </M>
  <Hint hasBg>npx nx run-many --target=serve --all</Hint>
  <M>
    and all applications will be run on different ports, in my case <B>3001</B>{" "}
    and <B>3002</B>. Looks cool? Yea!
  </M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/3cd43866db3fe6c780dabb322bba7ba9ff5ac856/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>8. Using libraries</XL>
  <M>
    Take a look at this. Do you want to use a component library in two
    applications? Forget about <B>npm install</B>. All you need is a simple{" "}
    <B>import</B> statement.
  </M>
  <Snippet
    linesCount={7}
    src="/snippets/dream-stack-for-react-dev/how-to-import.tsx"
    description="The power of monorepo and nx"
  />
  <M>Who cares about configuring aliases for webpack? Certainly not you :D</M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/eb157141da07fc66219ef3bbfa76f5784f7062df/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>9. Adding custom fonts</XL>
  <M>
    We need to download the fonts. <B>Lexend</B> variant will be suitable for us
    so let's take it from{" "}
    <A href="https://fonts.google.com/specimen/Lexend?query=Lexend" outside>
      Google Fonts
    </A>{" "}
    in the following sizes (300, 400, 500, 700). Immediately after that, we need
    to place the files in the appropriate directory - our <B>figa-ui</B>{" "}
    library.
  </M>
  <M>
    We are using <B>styled-components</B> so there is a need to create global
    styles, in which we'll declare our setup for fonts.
  </M>
  <Snippet
    linesCount={31}
    src="/snippets/dream-stack-for-react-dev/global-style.ts"
    description="Almost, but not yet"
  />
  <M>
    The current setup doesn't work yet. We need to add minor changes in the{" "}
    <B>preview.js</B> file and its extension must be changed to <B>.tsx</B>.
  </M>
  <Snippet
    linesCount={18}
    src="/snippets/dream-stack-for-react-dev/preview.tsx"
  />
  <M>
    In the <B>ts.config</B> file, we need to add <B>preview.tsx</B> to{" "}
    <B>include</B> array. Errors will be displayed if we skip that.
  </M>
  <Snippet>{`  "include": [
    {/* ...Other files */}
    "preview.tsx"
  ]`}</Snippet>
  <M>
    Well, how to test it? We need a component. Below is a partial implementation
    of <B>Font</B> component and usage in various places.
  </M>
  <Snippet
    linesCount={94}
    description="Partial implementation and usage"
    src="/snippets/dream-stack-for-react-dev/Font.tsx"
  />
  <M>
    At this stage, the fonts should look the same in the storybook, in the SPA
    application in React, and in the Next.js application.
  </M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/9e7c0a7e54913bf4522c0a29c78e5b6d41fc8e8b/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Section>
  <XL>10. Adding husky</XL>
  <M>
    Husky is a library that allows you to run a scripts before a specific{" "}
    <B>git hook</B>. It is usually used to check code consistency, run tests and
    format code before commit. Let's install it via command{" "}
    <B>npm i --save-dev husky</B>.
  </M>
  <Hint hasBg>
    On{" "}
    <A href="https://git-scm.com/docs/githooks" outside>
      this page
    </A>{" "}
    you have a list of all hooks.
  </Hint>
  <M>
    Before each commit we need to format code with <B>prettier</B> and perform
    check with <B>eslint</B>. Fortunately for us, nx provides the configuration
    of both by default so the only thing left is the husky setup. To do this, we
    need to define an aliases for the scripts in <B>package.json</B>.
  </M>
  <Snippet>
    {`
"scripts": {
   "prepare": "cd .. && husky install system/.husky", // Changes folder and configures husky.
   "lint:fixAll": "npx nx run-many --target=lint --all --fix", // Runs linter and fixes if possible.
   "format:fixAll": "prettier --write \"./**/*.{js,ts,tsx}\"" // Runs prettier and formats if possible.
}
`}
  </Snippet>
  <M>
    Now every developer must run the <B>prepare</B> command after downloading
    the repository. Without that, husky will not work. After launching, you
    should see the <B>.husky directory</B> and the <B>pre-commit</B> file that
    needs to be changed.
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/husky-created.jpg"
    description="Husky ready"
  />
  <M>
    The last change is to define the scripts that will be executed before the
    commit.
  </M>
  <Snippet>
    {`
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
cd system 
echo "Runnig linting and fix..."
npm run lint:fixAll
npm run format:fixAll
`}
  </Snippet>
  <M>
    Now every time when someone tries to do a commit then the scripts will be
    executed. If you want to skip the husky because you're just checking
    something, then use the <B>git commit -m "I'm just checking" --no-verify</B>.
  </M>
  <Hint hasBg>
    In this nice looking{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/6821d08d99e8642ab74835fee34fc421a4472d0d/"
    >
      commit
    </A>{" "}
    you have the current progress.
  </Hint>
</Section>

<Example>
  <M>
    <A href="https://github.com/polubis/Dream-stack-for-React-dev/" outside>
      Repository
    </A>{" "}
    to play with.
  </M>
</Example>

<Summary>
  <M>
    We went through the wonderful tool together. I recommend playing with it. We
    have described only a part of the possibilities.
  </M>
  <M>
    There is still place to add many more things. However, I think that it is
    better to add a little less than more.
  </M>
  <M>
    If you enjoyed it, be sure to visit us on{" "}
    <A href="https://www.linkedin.com/company/greenon-software/" outside>
      Linkedin
    </A>
    , where we regularly upload content from programming.
  </M>
</Summary>
